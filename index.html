<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>UsTrip æ—…è¡ŒåŠ©æ‰‹</title>
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
  />

  <!-- Vue.js 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Leaflet Map -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- FontAwesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
  <!-- SortableJS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

  <!-- å­—ä½“ï¼šæ›´é€‚åˆç®€ä½“ä¸­æ–‡çš„ Noto Sans SC -->
  <link
    href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700;900&display=swap"
    rel="stylesheet"
  />

  <style>
    body {
      font-family: "Noto Sans SC", system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
      background-color: #f0f4f8;
      -webkit-tap-highlight-color: transparent;
      overflow-x: hidden;
      color: #1e293b;
      overscroll-behavior-y: none;
    }

    .app-bg {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: url("https://images.unsplash.com/photo-1490806843957-31f4c9a91c65?q=80&w=2070&auto=format&fit=crop");
      background-size: cover;
      background-position: center center;
      z-index: -2;
      pointer-events: none;
    }

    .app-blur-layer {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(4px);
      z-index: -1;
      pointer-events: none;
    }

    #scroll-container {
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
      position: relative;
      z-index: 10;
      padding-bottom: 160px;
    }

    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }
    .no-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }

    .bg-main-blue {
      background-color: #4b6cb7;
    }
    .text-main-blue {
      color: #4b6cb7;
    }

    #map {
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    .sortable-ghost {
      opacity: 0.4;
      background: #eef2f6;
    }
    .sortable-drag {
      cursor: grabbing;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .animate-fade-in {
      animation: fadeIn 0.3s ease-out forwards;
    }

    .card-bg {
      background-color: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(12px);
    }

    .header-bg {
      background-color: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(10px);
    }

    .flight-card {
      background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
      color: white;
      position: relative;
      overflow: hidden;
    }
    .flight-card::after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: radial-gradient(
        circle at top right,
        rgba(255, 255, 255, 0.2) 0%,
        transparent 60%
      );
      pointer-events: none;
    }
    .flight-line {
      border-top: 2px dashed rgba(255, 255, 255, 0.4);
    }

    .bottom-nav {
      position: fixed;
      bottom: 32px;
      left: 24px;
      right: 24px;
      z-index: 9999;
      max-width: 420px;
      margin: 0 auto;
    }
  </style>
</head>
<body>
<div id="app">
  <div class="app-bg"></div>
  <div class="app-blur-layer"></div>

  <div id="scroll-container">
    <!-- é¡¶éƒ¨ Header -->
    <div
      v-if="['schedule','map','todo','money','shop','info'].includes(currentTab)"
      class="sticky top-0 z-40 header-bg pt-4 pb-2 shadow-sm rounded-b-3xl"
    >
      <div class="px-6 mb-3 flex justify-between items-center">
        <div>
          <h1
            class="text-xl font-black text-slate-800 tracking-widest flex items-center gap-2"
          >
            UsTrip å°æ¹¾
            <i class="fas fa-plane-departure text-blue-400"></i>
          </h1>
          <p class="text-[10px] text-slate-500 font-bold mt-1">
            æˆ‘å’Œ Mabel çš„æ—…è¡Œè®¡åˆ’
          </p>
        </div>
        <div class="text-right">
          <div class="text-[10px] text-slate-500 font-bold">å½“å‰æ±‡ç‡</div>
          <div class="font-bold text-main-blue text-sm">
            1 {{ settings.baseCurrencyCode }} â‰ˆ {{ exchangeRate }}
            {{ settings.targetCurrencyCode }}
          </div>
        </div>
      </div>

      <!-- æ—¥æœŸé€‰æ‹©ï¼ˆå«è¡Œå‰ï¼‰ -->
      <div class="flex overflow-x-auto no-scrollbar px-4 space-x-3 pb-2 snap-x">
        <div
          @click="selectDate('todo')"
          class="snap-center flex-shrink-0 w-16 h-20 rounded-2xl flex flex-col items-center justify-center transition-all duration-300 cursor-pointer border-2"
          :class="selectedDate === 'todo'
            ? 'bg-orange-50 border-orange-200 text-orange-500 shadow-md'
            : 'bg-white/80 border-slate-200 text-slate-400'"
        >
          <i class="fas fa-clipboard-list text-xl mb-1"></i>
          <span class="text-[11px] font-bold">è¡Œå‰</span>
        </div>

        <div
          v-for="(dayObj, index) in tripDates"
          :key="index"
          @click="selectDate(dayObj.date)"
          class="snap-center flex-shrink-0 w-16 h-20 rounded-2xl flex flex-col items-center justify-center transition-all duration-300 cursor-pointer border-2"
          :class="selectedDate === dayObj.date
            ? 'bg-main-blue border-blue-300 text-white shadow-lg shadow-blue-200'
            : 'bg-white/80 border-slate-200 text-slate-400'"
        >
          <span class="text-[11px] font-bold">{{ dayObj.day }}</span>
          <span class="text-xl font-black">{{
            dayObj.date.split('-')[2]
          }}</span>
        </div>
      </div>
    </div>

    <div class="px-4 pt-4">
      <!-- è¡Œå‰å¾…åŠ -->
      <div
        v-if="currentTab === 'schedule' && selectedDate === 'todo'"
        class="space-y-4 animate-fade-in"
      >
        <div class="flex justify-between items-end mb-2 px-2">
          <h2
            class="text-lg font-bold text-slate-800 drop-shadow-sm bg-white/40 px-2 rounded-lg backdrop-blur-sm inline-block"
          >
            è¡Œå‰å¾…åŠ
          </h2>
          <button
            @click="openModal('todo')"
            class="text-sm bg-orange-100 text-orange-700 px-3 py-1.5 rounded-full hover:bg-orange-200 transition font-bold shadow-sm"
          >
            <i class="fas fa-plus mr-1"></i>æ–°å¢
          </button>
        </div>
        <div class="space-y-2">
          <div
            v-for="item in todoList"
            :key="item.id"
            class="card-bg p-4 rounded-2xl shadow-sm border border-slate-100/50 flex items-center justify-between"
          >
            <div class="flex items-center gap-3">
              <button
                @click="toggleTodo(item)"
                class="w-6 h-6 rounded-lg border-2 flex items-center justify-center transition-all"
                :class="item.done
                  ? 'bg-orange-400 border-orange-400 text-white'
                  : 'border-slate-400 text-transparent'"
              >
                <i class="fas fa-check text-xs"></i>
              </button>
              <span
                :class="item.done
                  ? 'line-through text-slate-400'
                  : 'text-slate-800 font-bold'"
              >
                {{ item.text }}
              </span>
            </div>
            <div class="flex items-center gap-2">
              <button
                @click="openModal('todo', item)"
                class="text-slate-400 hover:text-main-blue"
              >
                <i class="fas fa-pen"></i>
              </button>
              <button
                @click="deleteItem('todo', item.id)"
                class="text-slate-400 hover:text-red-500"
              >
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- æ¯æ—¥è¡Œç¨‹ -->
      <div
        v-if="currentTab === 'schedule' && selectedDate !== 'todo'"
        class="space-y-4 animate-fade-in"
      >
        <!-- å¤©æ°”å¡ç‰‡ -->
        <div
          class="bg-white/60 backdrop-blur-md rounded-2xl p-4 shadow-sm border border-white/40 flex items-center justify-between text-slate-700"
        >
          <div class="flex items-center gap-3">
            <div class="text-4xl text-sky-500 drop-shadow-sm">
              <i :class="weatherInfo.icon"></i>
            </div>
            <div>
              <div class="text-2xl font-black leading-none">
                {{ weatherInfo.temp }}Â°C
              </div>
              <div class="text-[10px] font-bold opacity-70 mt-1">
                ä½“æ„Ÿ {{ weatherInfo.feel }}Â°C Â· {{ weatherInfo.desc }}
              </div>
            </div>
          </div>
          <div class="text-right">
            <div
              class="text-xs font-bold bg-sky-100 text-sky-600 px-2 py-1 rounded-full mb-1"
            >
              <i class="fas fa-map-marker-alt mr-1"></i>
              {{ settings.weatherCity }}
            </div>
            <p class="text-[10px] text-slate-400 font-bold">
              å¤©æ°”æ•°æ®æ¥è‡ªå…¬å¼€æ¥å£
            </p>
          </div>
        </div>

        <div class="flex justify-between items-end px-1 pt-2">
          <h2
            class="text-lg font-bold text-slate-800 drop-shadow-sm bg-white/40 px-2 rounded-lg backdrop-blur-sm inline-block"
          >
            å½“æ—¥è¡Œç¨‹
          </h2>
          <button
            @click="openModal('schedule', null)"
            class="text-sm bg-main-blue text-white px-4 py-1.5 rounded-full shadow-lg shadow-blue-200/50 transition transform active:scale-95 font-bold"
          >
            <i class="fas fa-plus mr-1"></i>æ–°å¢
          </button>
        </div>

        <div ref="sortableList" class="space-y-4">
          <div
            v-for="item in dailyItinerary"
            :key="item.id"
            :data-id="item.id"
            class="cursor-grab active:scale-[0.99] transition-transform"
          >
            <!-- èˆªç­å¡ç‰‡ -->
            <div
              v-if="item.category === 'flight'"
              class="flight-card rounded-3xl p-5 shadow-lg shadow-blue-900/20 group relative"
            >
              <div
                class="flex justify-between items-start mb-4 relative z-10"
              >
                <div class="flex items-center gap-2">
                  <span
                    class="bg-white/20 px-2 py-0.5 rounded text-[10px] font-bold backdrop-blur-sm"
                    >èˆªç­</span
                  >
                  <span class="font-mono font-bold text-blue-100">{{
                    item.time
                  }}</span>
                </div>
                <div class="flex items-center gap-2">
                  <span
                    class="text-[10px] bg-white/20 px-2 py-0.5 rounded-full font-bold"
                    v-if="item.showOnMap !== false"
                    ><i class="fas fa-map-marker-alt mr-1"></i>å·²åœ¨åœ°å›¾</span
                  >
                  <button
                    @click.stop="openModal('schedule', item)"
                    class="text-white/70 hover:text-white px-2"
                  >
                    <i class="fas fa-pen text-sm"></i>
                  </button>
                </div>
              </div>

              <div
                class="flex items-center justify-between relative z-10"
              >
                <div>
                  <div class="text-xs text-blue-200 font-bold mb-0.5">
                    FROM
                  </div>
                  <div class="text-xl font-black tracking-wide">
                    {{ item.fromCode || 'HKG' }}
                  </div>
                </div>
                <div class="flex-1 px-4 text-center">
                  <i
                    class="fas fa-plane text-2xl text-white/80 rotate-45"
                  ></i>
                  <div class="flight-line w-full my-1"></div>
                  <div
                    class="text-[10px] text-blue-200 font-mono"
                  >
                    {{ item.flightNo || 'èˆªç­å·' }}
                  </div>
                </div>
                <div class="text-right">
                  <div class="text-xs text-blue-200 font-bold mb-0.5">
                    TO
                  </div>
                  <div class="text-xl font-black tracking-wide">
                    {{ item.toCode || 'TPE' }}
                  </div>
                </div>
              </div>

              <div
                class="mt-4 pt-3 border-t border-white/10 relative z-10 flex justify-between items-center"
              >
                <span class="text-sm font-bold text-white">
                  {{ item.location }}
                </span>
                <span
                  class="text-[10px] bg-white text-blue-800 px-2 py-1 rounded font-bold"
                  >{{ item.status || 'å·²ç¡®è®¤' }}</span
                >
              </div>

              <div
                v-if="item.mapsUrl"
                class="mt-3 flex justify-end relative z-10"
              >
                <a
                  :href="item.mapsUrl"
                  target="_blank"
                  class="text-[11px] bg-white/90 text-blue-700 px-3 py-1.5 rounded-full font-bold flex items-center gap-1 shadow-sm"
                >
                  <i class="fas fa-location-arrow"></i> åœ¨ Google Maps æ‰“å¼€
                </a>
              </div>
            </div>

            <!-- æ™®é€šè¡Œç¨‹å¡ç‰‡ -->
            <div
              v-else
              class="relative card-bg border border-slate-100/50 rounded-3xl p-4 shadow-sm flex gap-4 group"
            >
              <div class="flex flex-col items-center pt-1 min-w-[44px]">
                <div
                  class="w-11 h-11 rounded-2xl flex items-center justify-center text-white text-lg shadow-md mb-2 transition-transform group-hover:rotate-6"
                  :class="getCategoryColor(item.category)"
                >
                  <i :class="getCategoryIcon(item.category)"></i>
                </div>
                <span
                  class="text-sm font-bold text-slate-500 font-mono tracking-tighter"
                  >{{ item.time }}</span
                >
                <span
                  v-if="item.showOnMap !== false"
                  class="mt-1 text-[10px] text-green-500 font-bold"
                  ><i class="fas fa-map-marker-alt"></i></span
                >
              </div>

              <div class="flex-1 min-w-0">
                <div class="flex justify-between items-start">
                  <div class="min-w-0">
                    <h3
                      class="font-bold text-slate-800 text-lg truncate"
                    >
                      {{ item.location }}
                    </h3>
                    <p
                      v-if="item.category === 'food'"
                      class="text-[11px] font-bold text-orange-500 mt-0.5"
                    >
                      ç¾é£Ÿ
                    </p>
                    <p
                      v-else-if="item.category === 'shopping'"
                      class="text-[11px] font-bold text-pink-500 mt-0.5"
                    >
                      è´­ç‰©
                    </p>
                  </div>
                  <div class="flex items-center gap-2">
                    <button
                      @click.stop="openModal('schedule', item)"
                      class="text-slate-400 hover:text-main-blue px-2"
                    >
                      <i class="fas fa-pen text-sm"></i>
                    </button>
                    <button
                      @click.stop="deleteItem('schedule', item.id)"
                      class="text-slate-300 hover:text-red-400 px-1"
                    >
                      <i class="fas fa-trash text-sm"></i>
                    </button>
                  </div>
                </div>

                <div class="flex items-center mt-1 mb-2">
                  <a
                    :href="item.mapsUrl
                      ? item.mapsUrl
                      : 'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(item.location + ' ' + (item.address || ''))"
                    target="_blank"
                    class="text-[10px] bg-blue-50 text-blue-600 px-2 py-1 rounded-lg hover:bg-blue-100 transition flex items-center gap-1 font-bold"
                  >
                    <i class="fas fa-location-arrow"></i> å¯¼èˆª
                  </a>
                  <span
                    class="text-slate-500 text-xs ml-2 truncate font-medium"
                    v-if="item.address"
                    >{{ item.address }}</span
                  >
                </div>

                <div
                  v-if="item.note"
                  class="bg-slate-50/80 p-2.5 rounded-xl text-xs text-slate-600 leading-relaxed border border-slate-100/50"
                >
                  {{ item.note }}
                </div>
              </div>
            </div>
          </div>
        </div>

        <div
          v-if="dailyItinerary.length === 0"
          class="text-center py-12 text-slate-600 bg-white/30 rounded-3xl backdrop-blur-sm"
        >
          <p class="font-bold">ä»Šå¤©è¿˜æ²¡æœ‰å®‰æ’è¡Œç¨‹</p>
          <p class="text-xs mt-1 text-slate-400">ç‚¹å³ä¸Šè§’ã€Œæ–°å¢ã€å¼€å§‹è§„åˆ’</p>
        </div>
      </div>

      <!-- åœ°å›¾ -->
      <div
        v-show="currentTab === 'map'"
        class="animate-fade-in flex flex-col items-center justify-center"
      >
        <div
          class="aspect-square w-full rounded-3xl overflow-hidden shadow-lg border-4 border-white/80 relative"
        >
          <div id="map"></div>

          <!-- åœ°å›¾æ¨¡å¼åˆ‡æ¢ï¼šæ ‡å‡† / å…¬å…±äº¤é€š -->
          <div
            class="absolute bottom-4 left-4 z-[500] bg-white/90 backdrop-blur px-3 py-1.5 rounded-full shadow text-[11px] font-bold flex items-center gap-2"
          >
            <span><i class="fas fa-map"></i> åœ°å›¾æ¨¡å¼</span>
            <button
              @click="toggleMapMode"
              class="ml-1 text-xs px-2 py-1 rounded-full border border-slate-200"
              :class="mapMode === 'transit'
                ? 'bg-emerald-100 text-emerald-700'
                : 'bg-slate-100 text-slate-600'"
            >
              {{ mapMode === 'transit' ? 'å…¬å…±äº¤é€š' : 'æ ‡å‡†' }}
            </button>
          </div>

          <div
            class="absolute top-4 right-4 bg-white/90 backdrop-blur px-3 py-1.5 rounded-xl shadow-md z-[400] text-xs font-bold text-slate-600"
          >
            <i class="fas fa-map-pin text-red-400 mr-1"></i>
            {{ mapMarkersCount }} ä¸ªåœ°æ ‡
          </div>
        </div>
        <p
          class="text-xs text-slate-700 mt-4 text-center font-bold bg-white/60 inline-block px-3 py-1 rounded-full backdrop-blur-sm shadow-sm"
        >
          åªæ˜¾ç¤ºå‹¾é€‰ã€Œåœ¨åœ°å›¾æ˜¾ç¤ºã€çš„è¡Œç¨‹åœ°æ ‡
        </p>
      </div>

      <!-- è®°è´¦ -->
      <div
        v-if="currentTab === 'money'"
        class="space-y-6 pt-6 animate-fade-in"
      >
        <h2
          class="text-2xl font-black text-slate-800 drop-shadow-sm bg-white/40 px-2 rounded-lg backdrop-blur-sm inline-block mx-2"
        >
          æ—…è¡Œè®°è´¦
        </h2>

        <div
          class="bg-gradient-to-br from-main-blue to-[#324968] p-6 rounded-3xl text-white pisariaqart shadow-xl shadow-blue-900/20 relative overflow-hidden mx-1"
        >
          <i
            class="fas fa-coins absolute -right-6 -bottom-6 text-9xl opacity-10 rotate-12"
          ></i>

          <div class="mb-4 text-center">
            <p class="text-xs font-medium opacity-80 mb-1">
              æ€»æ”¯å‡ºï¼ˆ{{ settings.baseCurrencyCode }}ï¼‰
            </p>
            <h3 class="text-4xl font-black tracking-tight">
              {{ totalExpenseBase || 0 }}
            </h3>
            <p class="text-xs opacity-70 mt-1">
              æŠ˜åˆ {{ settings.targetCurrencyCode }} çº¦
              {{ totalExpenseTarget || 0 }}
            </p>
          </div>

          <div
            class="grid grid-cols-2 gap-4 border-t border-white/20 pt-4 mt-2"
          >
            <div class="text-center border-r border-white/20">
              <div
                class="flex items-center justify-center gap-1 text-green-200 mb-1"
              >
                <i class="fas fa-money-bill-wave text-xs"></i>
                <span class="text-[10px] font-bold">ç°é‡‘</span>
              </div>
              <div class="font-black text-xl">
                {{ totalCashBase || 0 }}
              </div>
              <div class="text-[10px] opacity-70">
                â‰ˆ {{ totalCashTarget || 0 }}
                {{ settings.targetCurrencyCode }}
              </div>
            </div>
            <div class="text-center">
              <div
                class="flex items-center justify-center gap-1 text-purple-200 mb-1"
              >
                <i class="fas fa-credit-card text-xs"></i>
                <span class="text-[10px] font-bold">ä¿¡ç”¨å¡</span>
              </div>
              <div class="font-black text-xl">
                {{ totalCardBase || 0 }}
              </div>
              <div class="text-[10px] opacity-70">
                â‰ˆ {{ totalCardTarget || 0 }}
                {{ settings.targetCurrencyCode }}
              </div>
            </div>
          </div>
        </div>

        <div>
          <div class="flex flex-col gap-3 mb-4 px-1">
            <div class="flex justify-between items-center">
              <h3
                class="font-bold text-slate-800 bg-white/40 px-2 rounded-lg backdrop-blur-sm"
              >
                æ¶ˆè´¹æ˜ç»†
              </h3>
              <button
                @click="openModal('money')"
                class="text-main-blue text-sm font-bold bg-white/90 px-3 py-1.5 rounded-full shadow-sm"
              >
                <i class="fas fa-plus mr-1"></i>è®°ä¸€ç¬”
              </button>
            </div>

            <div
              class="flex bg-white/50 backdrop-blur-md p-1 rounded-xl text-xs font-bold"
            >
              <button
                @click="expenseFilter = 'all'"
                class="flex-1 py-1.5 rounded-lg transition-all"
                :class="expenseFilter === 'all'
                  ? 'bg-white shadow text-main-blue'
                  : 'text-slate-500'"
              >
                å…¨éƒ¨
              </button>
              <button
                @click="expenseFilter = 'cash'"
                class="flex-1 py-1.5 rounded-lg transition-all"
                :class="expenseFilter === 'cash'
                  ? 'bg-white shadow text-green-600'
                  : 'text-slate-500'"
              >
                ç°é‡‘
              </button>
              <button
                @click="expenseFilter = 'card'"
                class="flex-1 py-1.5 rounded-lg transition-all"
                :class="expenseFilter === 'card'
                  ? 'bg-white shadow text-purple-600'
                  : 'text-slate-500'"
              >
                ä¿¡ç”¨å¡
              </button>
            </div>
          </div>

          <div class="space-y-3 pb-4">
            <div
              v-for="exp in filteredExpenses"
              :key="exp.id"
              class="flex justify-between items-center card-bg p-4 rounded-2xl shadow-sm border border-slate-100/50"
            >
              <div class="flex items-center gap-3">
                <div
                  class="w-10 h-10 rounded-full flex items-center justify-center text-lg shadow-sm"
                  :class="exp.paymentMethod === 'card'
                    ? 'bg-purple-100 text-purple-500'
                    : 'bg-green-100 text-green-500'"
                >
                  <i
                    :class="exp.paymentMethod === 'card'
                      ? 'fas fa-credit-card'
                      : 'fas fa-money-bill-wave'"
                  ></i>
                </div>
                <div>
                  <p class="font-bold text-slate-800">{{ exp.item }}</p>
                  <p
                    class="text-[10px] text-slate-500 font-bold bg-slate-100/80 inline-block px-1.5 rounded mt-0.5"
                  >
                    {{ exp.date }}
                  </p>
                </div>
              </div>
              <div class="text-right">
                <p class="font-bold text-slate-800">
                  - {{ exp.amount }} {{ settings.baseCurrencyCode }}
                </p>
                <p class="text-xs text-slate-500 font-medium">
                  â‰ˆ {{ Math.round(exp.amount * exchangeRate) }}
                  {{ settings.targetCurrencyCode }}
                </p>
              </div>
              <div class="flex flex-col items-end ml-2 gap-1">
                <button
                  @click="openModal('money', exp)"
                  class="text-slate-300 hover:text-main-blue"
                >
                  <i class="fas fa-pen"></i>
                </button>
                <button
                  @click="deleteItem('expense', exp.id)"
                  class="text-slate-300 hover:text-red-400"
                >
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
            <div
              v-if="filteredExpenses.length === 0"
              class="text-center text-sm text-slate-500 py-4"
            >
              è¿˜æ²¡æœ‰è®°è´¦è®°å½•
            </div>
          </div>
        </div>
      </div>

      <!-- è´­ç‰©æ¸…å• -->
      <div
        v-if="currentTab === 'shop'"
        class="space-y-6 pt-6 animate-fade-in"
      >
        <div class="flex justify-between items-center px-2">
          <h2
            class="text-2xl font-black text-slate-800 drop-shadow-sm bg-white/40 px-2 rounded-lg backdrop-blur-sm inline-block"
          >
            è´­ç‰©æ¸…å•
          </h2>
          <button
            @click="openModal('shop')"
            class="bg-slate-800 text-white w-10 h-10 rounded-full shadow-lg flex items-center justify-center active:scale-90 transition"
          >
            <i class="fas fa-plus"></i>
          </button>
        </div>

        <div class="grid grid-cols-2 gap-4 pb-4">
          <div
            v-for="item in shoppingList"
            :key="item.id"
            class="card-bg p-3 rounded-2xl shadow-sm border border-slate-100/50 flex flex-col justify-between relative overflow-hidden transition-all group"
            :class="item.bought ? 'opacity-60 bg-slate-50 grayscale' : ''"
          >
            <div
              v-if="item.image"
              class="w-full h-28 mb-2 overflow-hidden rounded-xl bg-slate-100 border border-slate-100"
            >
              <img
                :src="item.image"
                class="w-full h-full object-cover group-hover:scale-110 transition duration-500"
              />
            </div>
            <div
              v-else
              class="w-full h-28 mb-2 rounded-xl bg-slate-50 flex items-center justify-center text-slate-300 border border-slate-200 border-dashed"
            >
              <i class="fas fa-image text-3xl"></i>
            </div>

            <div>
              <h3
                class="font-bold text-slate-800 text-sm mb-1 line-clamp-2"
                :class="item.bought ? 'line-through' : ''"
              >
                {{ item.name }}
              </h3>
              <p class="text-xs text-slate-500 font-bold">
                {{
                  item.price
                    ? (item.price + ' ' + (item.currency || settings.baseCurrencyCode))
                    : 'ä»·æ ¼æœªè®¾å®š'
                }}
              </p>
            </div>

            <div class="flex justify-between items-end mt-3">
              <div class="flex gap-2">
                <button
                  @click="openModal('shop', item)"
                  class="text-slate-300 hover:text-main-blue text-xs p-1"
                >
                  <i class="fas fa-pen"></i>
                </button>
                <button
                  @click="deleteItem('shop', item.id)"
                  class="text-slate-300 hover:text-red-400 text-xs p-1"
                >
                  <i class="fas fa-trash"></i>
                </button>
              </div>
              <button
                @click="toggleBought(item)"
                class="w-8 h-8 rounded-full flex items-center justify-center transition-colors shadow-sm"
                :class="item.bought
                  ? 'bg-green-100 text-green-500'
                  : 'bg-white text-slate-300 border border-slate-200'"
              >
                <i class="fas fa-check"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- ä¿¡æ¯ / æ”¶è—åœ°ç‚¹ -->
      <div
        v-if="currentTab === 'info'"
        class="space-y-6 pt-6 animate-fade-in"
      >
        <div class="flex justify-between items-center px-2">
          <h2
            class="text-2xl font-black text-slate-800 drop-shadow-sm bg-white/40 px-2 rounded-lg backdrop-blur-sm inline-block"
          >
            ä¿¡æ¯ / æ”¶è—åœ°ç‚¹
          </h2>
          <button
            @click="openModal('info')"
            class="text-sm bg-purple-100 text-purple-600 px-3 py-1.5 rounded-full hover:bg-purple-200 transition font-bold shadow-sm"
          >
            <i class="fas fa-plus mr-1"></i>æ–°å¢
          </button>
        </div>

        <div class="space-y-3 pb-4">
          <div
            v-for="info in infoList"
            :key="info.id"
            class="card-bg p-5 rounded-2xl shadow-sm border border-slate-100/50"
          >
            <div class="flex justify-between items-start mb-2">
              <h3
                class="font-bold text-slate-800 text-lg border-l-4 border-purple-300 pl-3"
              >
                {{ info.title }}
              </h3>
              <div class="flex gap-2">
                <button
                  @click="openModal('info', info)"
                  class="text-slate-400 hover:text-main-blue"
                >
                  <i class="fas fa-pen"></i>
                </button>
                <button
                  @click="deleteItem('info', info.id)"
                  class="text-slate-400 hover:text-red-400"
                >
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>

            <div
              class="text-slate-600 text-sm whitespace-pre-wrap leading-relaxed font-medium mb-2"
            >
              {{ info.content }}
            </div>

            <div
              v-if="info.mapsUrl"
              class="mt-2 flex justify-end"
            >
              <a
                :href="info.mapsUrl"
                target="_blank"
                class="text-[11px] bg-blue-50 text-blue-700 px-3 py-1.5 rounded-full font-bold flex items-center gap-1 shadow-sm"
              >
                <i class="fas fa-location-arrow"></i> åœ¨ Google Maps æ‰“å¼€
              </a>
            </div>
          </div>
          <div
            v-if="infoList.length === 0"
            class="text-center text-sm text-slate-500 py-4"
          >
            è¿™é‡Œå¯ä»¥è®°å½•é…’åº—ä¿¡æ¯ã€æœºåœºä¿¡æ¯ã€äº¤é€šæ”»ç•¥ã€é¤å…æ”¶è—ç­‰
          </div>
        </div>
      </div>

      <!-- è®¾ç½® -->
      <div
        v-if="currentTab === 'settings'"
        class="space-y-6 pt-6 animate-fade-in pb-8"
      >
        <h2
          class="text-2xl font-black text-slate-800 drop-shadow-sm bg-white/40 px-2 rounded-lg backdrop-blur-sm inline-block mx-2"
        >
          è®¾ç½®
        </h2>

        <!-- è¡Œç¨‹æ—¥æœŸ -->
        <div class="card-bg rounded-3xl p-4 shadow-sm border border-slate-100">
          <h3 class="font-bold text-slate-800 mb-3 flex items-center gap-2">
            <i class="fas fa-calendar-alt text-main-blue"></i> è¡Œç¨‹æ—¥æœŸ
          </h3>
          <div class="space-y-3 text-sm">
            <div class="flex items-center gap-3">
              <label class="w-20 text-slate-600 font-bold text-xs">
                å‡ºå‘æ—¥æœŸ
              </label>
              <input
                v-model="settings.tripStartDate"
                type="date"
                class="flex-1 bg-slate-50 rounded-xl p-2.5 text-slate-700 outline-none focus:ring-2 focus:ring-blue-200 border border-slate-100"
              />
            </div>
            <div class="flex items-center gap-3">
              <label class="w-20 text-slate-600 font-bold text-xs">
                è¡Œç¨‹å¤©æ•°
              </label>
              <input
                v-model.number="settings.tripDays"
                type="number"
                min="1"
                max="30"
                class="w-24 bg-slate-50 rounded-xl p-2.5 text-slate-700 outline-none focus:ring-2 focus:ring-blue-200 border border-slate-100 text-center"
              />
              <span class="text-[11px] text-slate-500"
                >ä¼šè‡ªåŠ¨ç”Ÿæˆã€Œç¬¬1å¤© ~ ç¬¬Nå¤©ã€</span
              >
            </div>
          </div>
        </div>

        <!-- æ±‡ç‡è®¾ç½® -->
        <div class="card-bg rounded-3xl p-4 shadow-sm border border-slate-100">
          <h3 class="font-bold text-slate-800 mb-3 flex items-center gap-2">
            <i class="fas fa-coins text-yellow-500"></i> æ±‡ç‡è®¾ç½®
          </h3>
          <div class="space-y-3 text-sm">
            <div class="flex items-center gap-3">
              <label class="w-20 text-slate-600 font-bold text-xs">
                åŸºç¡€å¸ç§
              </label>
              <input
                v-model="settings.baseCurrencyCode"
                type="text"
                class="w-24 bg-slate-50 rounded-xl p-2.5 text-slate-700 outline-none focus:ring-2 focus:ring-blue-200 border border-slate-100 text-center uppercase"
              />
            </div>
            <div class="flex items-center gap-3">
              <label class="w-20 text-slate-600 font-bold text-xs">
                ç›®æ ‡å¸ç§
              </label>
              <input
                v-model="settings.targetCurrencyCode"
                type="text"
                class="w-24 bg-slate-50 rounded-xl p-2.5 text-slate-700 outline-none focus:ring-2 focus:ring-blue-200 border border-slate-100 text-center uppercase"
              />
            </div>
            <div class="flex items-center gap-3">
              <label class="w-20 text-slate-600 font-bold text-xs">
                æ±‡ç‡
              </label>
              <input
                v-model.number="exchangeRate"
                type="number"
                step="0.0001"
                class="w-32 bg-slate-50 rounded-xl p-2.5 text-slate-700 outline-none focus:ring-2 focus:ring-blue-200 border border-slate-100 text-center"
              />
              <span class="text-[11px] text-slate-500"
                >1 {{ settings.baseCurrencyCode }} â‰ˆ {{ exchangeRate }}
                {{ settings.targetCurrencyCode }}</span
              >
            </div>
          </div>
        </div>

        <!-- å¤©æ°”è®¾ç½® -->
        <div class="card-bg rounded-3xl p-4 shadow-sm border border-slate-100">
          <h3 class="font-bold text-slate-800 mb-3 flex items-center gap-2">
            <i class="fas fa-cloud-sun text-sky-500"></i> å¤©æ°”è®¾ç½®
          </h3>
          <div class="space-y-3 text-sm">
            <div class="flex items-center gap-3">
              <label class="w-20 text-slate-600 font-bold text-xs">
                åŸå¸‚åç§°
              </label>
              <input
                v-model="settings.weatherCity"
                type="text"
                class="flex-1 bg-slate-50 rounded-xl p-2.5 text-slate-700 outline-none focus:ring-2 focus:ring-blue-200 border border-slate-100"
                placeholder="ä¾‹å¦‚ï¼šå°åŒ—"
              />
            </div>

            <!-- çº¬åº¦ / ç»åº¦ åˆ†ä¸¤è¡Œï¼Œé¿å…æº¢å‡º -->
            <div class="space-y-2">
              <div class="flex items-center gap-3">
                <label class="w-20 text-slate-600 font-bold text-xs">
                  çº¬åº¦ / ç»åº¦
                </label>
                <span class="text-[11px] text-slate-400"
                  >ç”¨äºå®šä½å¤©æ°”ä¸é»˜è®¤åœ°å›¾ä¸­å¿ƒ</span
                >
              </div>
              <div class="flex flex-col gap-2">
                <input
                  v-model.number="settings.weatherLat"
                  type="number"
                  step="0.0001"
                  class="w-full bg-slate-50 rounded-xl p-2.5 text-slate-700 outline-none focus:ring-2 focus:ring-blue-200 border border-slate-100"
                  placeholder="çº¬åº¦ï¼Œä¾‹å¦‚ï¼š25.0478"
                />
                <input
                  v-model.number="settings.weatherLng"
                  type="number"
                  step="0.0001"
                  class="w-full bg-slate-50 rounded-xl p-2.5 text-slate-700 outline-none focus:ring-2 focus:ring-blue-200 border border-slate-100"
                  placeholder="ç»åº¦ï¼Œä¾‹å¦‚ï¼š121.5319"
                />
              </div>
            </div>

            <p class="text-[11px] text-slate-400">
              å¤©æ°”ä½¿ç”¨å…¬å¼€æ¥å£å®æ—¶è·å–ï¼Œè‹¥ç½‘ç»œå¼‚å¸¸ä¼šè‡ªåŠ¨å›é€€åˆ°æ¨¡æ‹Ÿæ•°æ®ã€‚
            </p>
          </div>
        </div>

        <!-- æ•°æ®å¤‡ä»½ / å¯¼å…¥ -->
        <div class="card-bg rounded-3xl p-4 shadow-sm border border-slate-100">
          <h3 class="font-bold text-slate-800 mb-3 flex items-center gap-2">
            <i class="fas fa-database text-emerald-500"></i> æ•°æ®å¤‡ä»½ / å¯¼å…¥
          </h3>
          <div class="flex flex-col sm:flex-row gap-3 text-sm">
            <button
              @click="exportData"
              class="flex-1 py-2.5 rounded-xl bg-emerald-500 text-white font-bold shadow-md hover:bg-emerald-600 transition flex items-center justify-center gap-2"
            >
              <i class="fas fa-download"></i> å¯¼å‡ºæ•°æ®ï¼ˆJSONï¼‰
            </button>
            <button
              @click="triggerImport"
              class="flex-1 py-2.5 rounded-xl bg-slate-800 text-white font-bold shadow-md hover:bg-slate-900 transition flex items-center justify-center gap-2"
            >
              <i class="fas fa-upload"></i> å¯¼å…¥æ•°æ®
            </button>
          </div>
          <p class="mt-2 text-[11px] text-slate-400">
            å¯¼å‡ºæ–‡ä»¶å¯ä»¥ç”¨æ¥å¤‡ä»½æˆ–è¿ç§»åˆ°åˆ«çš„è®¾å¤‡ï¼Œå¯¼å…¥æ—¶ä¼šè¦†ç›–å½“å‰æ•°æ®ï¼ˆä¼šè‡ªåŠ¨è¡¥å…¨ç¼ºå°‘å­—æ®µï¼Œå°½é‡å…¼å®¹æ—§ç‰ˆæœ¬ï¼‰ã€‚
          </p>
          <input
            type="file"
            ref="importInput"
            class="hidden"
            accept="application/json"
            @change="handleImport"
          />
        </div>
      </div>
    </div>
  </div>

  <!-- åº•éƒ¨å¯¼èˆª -->
  <div
    class="bottom-nav bg-white/90 backdrop-blur-xl shadow-[0_10px_40px_-10px_rgba(0,0,0,0.3)] border border-slate-200/50 rounded-full"
  >
    <div class="flex justify-between items-center px-1">
      <button
        @click="switchTab('schedule')"
        class="flex-1 flex flex-col items-center py-3.5 transition-all active:scale-95"
        :class="currentTab === 'schedule'
          ? 'text-main-blue'
          : 'text-slate-400'"
      >
        <i class="fas fa-route text-xl mb-0.5"></i>
        <span class="text-[10px] font-bold">è¡Œç¨‹</span>
      </button>
      <button
        @click="switchTab('map')"
        class="flex-1 flex flex-col items-center py-3.5 transition-all active:scale-95"
        :class="currentTab === 'map'
          ? 'text-main-blue'
          : 'text-slate-400'"
      >
        <i class="fas fa-map-marked-alt text-xl mb-0.5"></i>
        <span class="text-[10px] font-bold">åœ°å›¾</span>
      </button>
      <button
        @click="switchTab('money')"
        class="flex-1 flex flex-col items-center py-3.5 transition-all active:scale-95"
        :class="currentTab === 'money'
          ? 'text-main-blue'
          : 'text-slate-400'"
      >
        <i class="fas fa-wallet text-xl mb-0.5"></i>
        <span class="text-[10px] font-bold">è®°è´¦</span>
      </button>
      <button
        @click="switchTab('shop')"
        class="flex-1 flex flex-col items-center py-3.5 transition-all active:scale-95"
        :class="currentTab === 'shop'
          ? 'text-main-blue'
          : 'text-slate-400'"
      >
        <i class="fas fa-shopping-bag text-xl mb-0.5"></i>
        <span class="text-[10px] font-bold">è´­ç‰©</span>
      </button>
      <button
        @click="switchTab('info')"
        class="flex-1 flex flex-col items-center py-3.5 transition-all active:scale-95"
        :class="currentTab === 'info'
          ? 'text-purple-400'
          : 'text-slate-400'"
      >
        <i class="fas fa-info-circle text-xl mb-0.5"></i>
        <span class="text-[10px] font-bold">ä¿¡æ¯</span>
      </button>
      <button
        @click="switchTab('settings')"
        class="flex-1 flex flex-col items-center py-3.5 transition-all active:scale-95"
        :class="currentTab === 'settings'
          ? 'text-slate-900'
          : 'text-slate-400'"
      >
        <i class="fas fa-cog text-xl mb-0.5"></i>
        <span class="text-[10px] font-bold">è®¾ç½®</span>
      </button>
    </div>
  </div>

  <!-- é€šç”¨å¼¹çª— -->
  <div
    v-if="showModal"
    class="fixed inset-0 z-[10000] bg-slate-900/60 backdrop-blur-sm flex items-end sm:items-center justify-center p-0 sm:p-4 animate-fade-in"
  >
    <div
      class="bg-white w-full sm:max-w-sm rounded-t-3xl sm:rounded-3xl p-6 shadow-2xl transform transition-all max-h-[90vh] overflow-y-auto"
    >
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-black text-slate-800">{{ modalTitle }}</h3>
        <button
          @click="closeModal"
          class="text-slate-300 hover:text-slate-500"
        >
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>

      <!-- è¡Œç¨‹è¡¨å•ï¼ˆå«èˆªç­ä¿¡æ¯ï¼‰ -->
      <div v-if="modalType === 'schedule'" class="space-y-3 text-sm">
        <div class="grid grid-cols-2 gap-3">
          <input
            v-model="newItem.time"
            type="time"
            class="bg-slate-50 rounded-xl p-3 text-slate-700 outline-none focus:ring-2 focus:ring-blue-200 font-bold border border-slate-100"
          />
          <select
            v-model="newItem.category"
            class="bg-slate-50 rounded-xl p-3 text-slate-700 outline-none focus:ring-2 focus:ring-blue-200 font-bold border border-slate-100"
          >
            <option value="sightseeing">ğŸ“¸ æ™¯ç‚¹</option>
            <option value="food">ğŸœ ç¾é£Ÿ</option>
            <option value="transport">ğŸš† äº¤é€š</option>
            <option value="flight">âœˆï¸ èˆªç­</option>
            <option value="shopping">ğŸ›ï¸ è´­ç‰©</option>
            <option value="other">âœ¨ å…¶ä»–</option>
          </select>
        </div>
        <input
          v-model="newItem.location"
          type="text"
          placeholder="åœ°ç‚¹ / èˆªæ®µåç§°ï¼Œä¾‹å¦‚ï¼šå‰éš†å¡ â†’ å°åŒ—"
          class="w-full bg-slate-50 rounded-xl p-3 text-slate-700 outline-none focus:ring-2 focus:ring-blue-200 border border-slate-100"
        />
        <input
          v-model="newItem.address"
          type="text"
          placeholder="åœ°å€ï¼ˆç”¨äºåœ°å›¾æœç´¢ï¼Œå¯é€‰ï¼‰"
          class="w-full bg-slate-50 rounded-xl p-3 text-slate-700 outline-none focus:ring-2 focus:ring-blue-200 text-sm border border-slate-100"
        />
        <textarea
          v-model="newItem.note"
          placeholder="å¤‡æ³¨ï¼Œä¾‹å¦‚ï¼šæå‰ 2 å°æ—¶åˆ°æœºåœºã€ä¸€å®šè¦åƒæŸå®¶åº—..."
          class="w-full bg-slate-50 rounded-xl p-3 text-slate-700 outline-none focus:ring-2 focus:ring-blue-200 h-20 resize-none text-sm border border-slate-100"
        ></textarea>
        <input
          v-model="newItem.mapsUrl"
          type="text"
          placeholder="Google Maps é“¾æ¥ï¼ˆå¯ç›´æ¥è´´ maps.app.goo.gl çš„çŸ­é“¾ï¼‰"
          class="w-full bg-slate-50 rounded-xl p-3 text-slate-700 outline-none focus:ring-2 focus:ring-blue-200 text-sm border border-slate-100"
        />

        <div
          class="flex items-center justify-between bg-slate-50 rounded-xl px-3 py-2 mt-1"
        >
          <label class="flex items-center gap-2 text-xs text-slate-600">
            <input
              type="checkbox"
              v-model="newItem.showOnMap"
              class="w-4 h-4 rounded border-slate-300"
            />
            åœ¨åœ°å›¾æ˜¾ç¤ºè¿™ä¸ªåœ°ç‚¹
          </label>
        </div>

        <!-- èˆªç­ä¸“ç”¨å­—æ®µ -->
        <div
          v-if="newItem.category === 'flight'"
          class="mt-2 grid grid-cols-2 gap-3 text-xs"
        >
          <input
            v-model="newItem.fromCode"
            type="text"
            placeholder="èµ·é£æœºåœºä»£ç ï¼ˆå¦‚ KULï¼‰"
            class="bg-slate-50 rounded-xl p-2.5 text-slate-700 outline-none focus:ring-2 focus:ring-blue-200 border border-slate-100"
          />
          <input
            v-model="newItem.toCode"
            type="text"
            placeholder="é™è½æœºåœºä»£ç ï¼ˆå¦‚ TPEï¼‰"
            class="bg-slate-50 rounded-xl p-2.5 text-slate-700 outline-none focus:ring-2 focus:ring-blue-200 border border-slate-100"
          />
          <input
            v-model="newItem.flightNo"
            type="text"
            placeholder="èˆªç­å·ï¼ˆå¯é€‰ï¼‰"
            class="bg-slate-50 rounded-xl p-2.5 text-slate-700 outline-none focus:ring-2 focus:ring-blue-200 border border-slate-100 col-span-2"
          />
          <input
            v-model="newItem.status"
            type="text"
            placeholder="çŠ¶æ€ï¼Œä¾‹å¦‚ï¼šå·²å€¼æœº / å¾…ç¡®è®¤"
            class="bg-slate-50 rounded-xl p-2.5 text-slate-700 outline-none focus:ring-2 focus:ring-blue-200 border border-slate-100 col-span-2"
          />
        </div>
      </div>

      <!-- è®°è´¦è¡¨å• -->
      <div v-if="modalType === 'money'" class="space-y-3 text-sm">
        <div class="flex gap-3">
          <select
            v-model="newItem.paymentMethod"
            class="flex-1 bg-slate-50 rounded-xl p-3 text-slate-700 outline-none focus:ring-2 focus:ring-blue-200 font-bold border border-slate-100"
          >
            <option value="cash">ğŸ’µ ç°é‡‘</option>
            <option value="card">ğŸ’³ ä¿¡ç”¨å¡</option>
          </select>
          <input
            v-model="newItem.date"
            type="text"
            placeholder="æ—¥æœŸï¼ˆå¦‚ 12-10ï¼‰"
            class="w-24 bg-slate-50 rounded-xl p-3 text-slate-700 text-center border border-slate-100"
          />
        </div>
        <input
          v-model="newItem.item"
          type="text"
          placeholder="æ¶ˆè´¹é¡¹ç›®ï¼Œä¾‹å¦‚ï¼šæ™šé¤ã€é—¨ç¥¨"
          class="w-full bg-slate-50 rounded-xl p-3 text-slate-700 outline-none focus:ring-2 focus:ring-blue-200 border border-slate-100"
        />
        <input
          v-model.number="newItem.amount"
          type="number"
          min="0"
          step="0.01"
          placeholder="é‡‘é¢ï¼ˆ{{ settings.baseCurrencyCode }}ï¼‰"
          class="w-full bg-slate-50 rounded-xl p-3 text-slate-700 outline-none focus:ring-2 focus:ring-blue-200 text-lg font-bold border border-slate-100"
        />
        <div
          class="text-right text-sm text-main-blue font-bold"
          v-if="newItem.amount"
        >
          â‰ˆ {{ (newItem.amount * exchangeRate).toFixed(1) }}
          {{ settings.targetCurrencyCode }}
        </div>
      </div>

      <!-- è´­ç‰©è¡¨å•ï¼ˆå¯é€‰å¸ç§ï¼‰ -->
      <div v-if="modalType === 'shop'" class="space-y-3 text-sm">
        <input
          v-model="newItem.name"
          type="text"
          placeholder="å•†å“åç§°ï¼Œä¾‹å¦‚ï¼šä¼´æ‰‹ç¤¼ã€æ¨¡å‹ã€è¡£æœ"
          class="w-full bg-slate-50 rounded-xl p-3 text-slate-700 outline-none focus:ring-2 focus:ring-blue-200 border border-slate-100"
        />
        <div class="flex gap-3">
          <input
            v-model.number="newItem.price"
            type="number"
            min="0"
            step="0.01"
            placeholder="é¢„ä¼°ä»·æ ¼"
            class="flex-1 bg-slate-50 rounded-xl p-3 text-slate-700 outline-none focus:ring-2 focus:ring-blue-200 border border-slate-100"
          />
          <input
            v-model="newItem.currency"
            type="text"
            placeholder="å¸ç§ï¼Œä¾‹å¦‚ï¼šMYR / TWD / JPY"
            class="w-32 bg-slate-50 rounded-xl p-3 text-slate-700 outline-none focus:ring-2 focus:ring-blue-200 border border-slate-100 text-center uppercase"
          />
        </div>
        <label
          class="block w-full bg-slate-50 border-2 border-dashed border-slate-200 rounded-xl p-4 text-center cursor-pointer hover:bg-slate-100 transition"
        >
          <input
            type="file"
            accept="image/*"
            class="hidden"
            @change="handleImageUpload"
          />
          <span
            v-if="!newItem.image"
            class="text-slate-400 text-sm font-bold"
            ><i class="fas fa-camera mr-2"></i>ä¸Šä¼ å›¾ç‰‡ï¼ˆå¤§å°ä¸è¶…è¿‡ 1MBï¼‰</span
          >
          <img
            v-else
            :src="newItem.image"
            class="h-20 mx-auto rounded-lg object-contain"
          />
        </label>
      </div>

      <!-- å¾…åŠè¡¨å• -->
      <div v-if="modalType === 'todo'" class="space-y-3 text-sm">
        <input
          v-model="newItem.text"
          type="text"
          placeholder="å¾…åŠäº‹é¡¹ï¼Œä¾‹å¦‚ï¼šä¹°ä¸Šç½‘å¡ã€æ¢å°å¸..."
          class="w-full bg-slate-50 rounded-xl p-3 text-slate-700 outline-none focus:ring-2 focus:ring-blue-200 border border-slate-100"
        />
      </div>

      <!-- ä¿¡æ¯ / æ”¶è—è¡¨å• -->
      <div v-if="modalType === 'info'" class="space-y-3 text-sm">
        <input
          v-model="newItem.title"
          type="text"
          placeholder="æ ‡é¢˜ï¼Œä¾‹å¦‚ï¼šå°åŒ—é…’åº— / å›ç¨‹èˆªç­ä¿¡æ¯"
          class="w-full bg-slate-50 rounded-xl p-3 text-slate-700 outline-none focus:ring-2 focus:ring-blue-200 border border-slate-100"
        />
        <textarea
          v-model="newItem.content"
          placeholder="å†…å®¹ï¼Œä¾‹å¦‚ï¼šå…¥ä½æ—¶é—´ã€è®¢æˆ¿ç¼–å·ã€æ³¨æ„äº‹é¡¹..."
          class="w-full bg-slate-50 rounded-xl p-3 text-slate-700 outline-none focus:ring-2 focus:ring-blue-200 h-32 resize-none border border-slate-100"
        ></textarea>
        <input
          v-model="newItem.mapsUrl"
          type="text"
          placeholder="Google Maps é“¾æ¥ï¼ˆå¯é€‰ï¼Œç”¨äºå¿«é€Ÿæ‰“å¼€åœ°å›¾ï¼‰"
          class="w-full bg-slate-50 rounded-xl p-3 text-slate-700 outline-none focus:ring-2 focus:ring-blue-200 border border-slate-100"
        />
      </div>

      <div class="flex space-x-3 mt-6">
        <button
          @click="closeModal"
          class="flex-1 py-3.5 rounded-xl bg-slate-100 text-slate-500 font-bold hover:bg-slate-200 transition"
        >
          å–æ¶ˆ
        </button>
        <button
          @click="saveItem"
          class="flex-1 py-3.5 rounded-xl bg-[#2C3E50] text-white font-bold shadow-lg shadow-slate-400 hover:bg-[#1a252f] transition"
        >
          ç¡®è®¤
        </button>
      </div>
      <div class="h-4 sm:h-0"></div>
    </div>
  </div>
</div>

<script>
  const { createApp, ref, computed, onMounted, nextTick, watch } = Vue;

  createApp({
    setup() {
      const STORAGE_KEY = "ustrip_data_v1";

      const currentTab = ref("schedule");
      const selectedDate = ref("todo");
      const showModal = ref(false);
      const modalType = ref("");
      const isEditing = ref(false);
      const newItem = ref({});
      const modalTitle = computed(() => {
        if (isEditing.value) return "ç¼–è¾‘é¡¹ç›®";
        const map = {
          schedule: "æ–°å¢è¡Œç¨‹",
          money: "æ–°å¢è®°è´¦",
          shop: "æ–°å¢è´­ç‰©",
          todo: "æ–°å¢å¾…åŠ",
          info: "æ–°å¢ä¿¡æ¯ / æ”¶è—",
        };
        return map[modalType.value] || "ç¼–è¾‘";
      });

      const settings = ref({
        baseCurrencyCode: "MYR",
        targetCurrencyCode: "TWD",
        tripStartDate: "2026-01-08",
        tripDays: 5,
        weatherCity: "å°åŒ—",
        weatherLat: 25.0478,
        weatherLng: 121.5319,
      });

      const exchangeRate = ref(7.0);

      const itineraryData = ref([]);
      const expenses = ref([]);
      const shoppingList = ref([]);
      const todoList = ref([]);
      const infoList = ref([]);

      const expenseFilter = ref("all");

      const mapObj = ref(null);
      const markers = ref([]);
      const sortableList = ref(null);
      let sortableInstance = null;

      // åœ°å›¾åº•å›¾å›¾å±‚
      let baseTileLayer = null;
      let transitTileLayer = null;
      const mapMode = ref("normal");

      const weatherInfo = ref({
        temp: "--",
        feel: "--",
        desc: "è¯»å–ä¸­...",
        icon: "fas fa-cloud",
      });

      const tripDates = computed(() => {
        const arr = [];
        if (!settings.value.tripStartDate || !settings.value.tripDays) {
          return arr;
        }
        const start = new Date(settings.value.tripStartDate);
        if (isNaN(start.getTime())) return arr;
        for (let i = 0; i < settings.value.tripDays; i++) {
          const d = new Date(start);
          d.setDate(start.getDate() + i);
          const yyyy = d.getFullYear();
          const mm = String(d.getMonth() + 1).padStart(2, "0");
          const dd = String(d.getDate()).padStart(2, "0");
          arr.push({
            date: `${yyyy}-${mm}-${dd}`,
            day: `ç¬¬${i + 1}å¤©`,
          });
        }
        return arr;
      });

      const dailyItinerary = computed(() =>
        itineraryData.value
          .filter((item) => item.date === selectedDate.value)
          .sort((a, b) => (a.time || "").localeCompare(b.time || ""))
      );

      const mapMarkersCount = computed(() =>
        dailyItinerary.value.filter((i) => i.showOnMap !== false).length
      );

      const totalExpenseBase = computed(() =>
        expenses.value.reduce(
          (sum, item) => sum + (parseFloat(item.amount) || 0),
          0
        )
      );
      const totalExpenseTarget = computed(() =>
        Math.round(totalExpenseBase.value * exchangeRate.value)
      );

      const totalCashBase = computed(() =>
        expenses.value
          .filter((e) => e.paymentMethod === "cash")
          .reduce((sum, item) => sum + (parseFloat(item.amount) || 0), 0)
      );
      const totalCashTarget = computed(() =>
        Math.round(totalCashBase.value * exchangeRate.value)
      );

      const totalCardBase = computed(() =>
        expenses.value
          .filter((e) => e.paymentMethod === "card")
          .reduce((sum, item) => sum + (parseFloat(item.amount) || 0), 0)
      );
      const totalCardTarget = computed(() =>
        Math.round(totalCardBase.value * exchangeRate.value)
      );

      const filteredExpenses = computed(() => {
        if (expenseFilter.value === "all") return expenses.value;
        return expenses.value.filter(
          (e) => e.paymentMethod === expenseFilter.value
        );
      });

      const getCategoryIcon = (cat) => {
        const map = {
          sightseeing: "fas fa-camera",
          food: "fas fa-utensils",
          transport: "fas fa-train",
          flight: "fas fa-plane",
          shopping: "fas fa-shopping-bag",
          other: "fas fa-star",
        };
        return map[cat] || "fas fa-map-marker-alt";
      };

      const getCategoryColor = (cat) => {
        const map = {
          sightseeing: "bg-pink-400",
          food: "bg-orange-400",
          transport: "bg-blue-500",
          flight: "bg-sky-500",
          shopping: "bg-yellow-400",
          other: "bg-slate-400",
        };
        return map[cat] || "bg-slate-400";
      };

      const selectDate = (date) => {
        selectedDate.value = date;
        if (currentTab.value === "map") {
          updateMapMarkers();
        }
        if (currentTab.value === "schedule" && date !== "todo") {
          initSortable();
          fetchWeather();
        }
      };

      const switchTab = (tab) => {
        currentTab.value = tab;
        if (tab === "map") {
          nextTick(() => {
            if (!mapObj.value) {
              initMap();
            } else {
              mapObj.value.invalidateSize();
            }
            updateMapMarkers();
          });
        }
        if (tab === "schedule" && selectedDate.value !== "todo") {
          initSortable();
          fetchWeather();
        }
      };

      const initSortable = () => {
        nextTick(() => {
          if (sortableList.value) {
            if (sortableInstance) sortableInstance.destroy();
            sortableInstance = new Sortable(sortableList.value, {
              animation: 150,
              delay: 100,
              delayOnTouchOnly: true,
              ghostClass: "sortable-ghost",
              dragClass: "sortable-drag",
              onEnd: (evt) => {
                const dayItems = [...dailyItinerary.value];
                const movedItem = dayItems.splice(evt.oldIndex, 1)[0];
                dayItems.splice(evt.newIndex, 0, movedItem);
                const others = itineraryData.value.filter(
                  (i) => i.date !== selectedDate.value
                );
                itineraryData.value = [...others, ...dayItems];
                saveToLocalStorage();
              },
            });
          }
        });
      };

      const openModal = (type, item = null) => {
        modalType.value = type;
        if (item) {
          isEditing.value = true;
          newItem.value = JSON.parse(JSON.stringify(item));
          if (type === "shop" && !newItem.value.currency) {
            newItem.value.currency = settings.value.baseCurrencyCode;
          }
        } else {
          isEditing.value = false;
          if (type === "money") {
            const today = new Date();
            const mm = String(today.getMonth() + 1).padStart(2, "0");
            const dd = String(today.getDate()).padStart(2, "0");
            newItem.value = {
              paymentMethod: "cash",
              date: `${mm}-${dd}`,
              amount: null,
              item: "",
            };
          } else if (type === "schedule") {
            newItem.value = {
              category: "sightseeing",
              time: "12:00",
              location: "",
              address: "",
              note: "",
              mapsUrl: "",
              showOnMap: true,
              fromCode: "",
              toCode: "",
              flightNo: "",
              status: "",
            };
          } else if (type === "shop") {
            newItem.value = {
              name: "",
              price: null,
              currency: settings.value.baseCurrencyCode,
              image: "",
            };
          } else if (type === "todo") {
            newItem.value = {
              text: "",
            };
          } else if (type === "info") {
            newItem.value = {
              title: "",
              content: "",
              mapsUrl: "",
            };
          }
        }
        showModal.value = true;
      };

      const closeModal = () => {
        showModal.value = false;
        isEditing.value = false;
        newItem.value = {};
      };

      const handleImageUpload = (event) => {
        const file = event.target.files[0];
        if (file) {
          const maxSize = 1024 * 1024;
          if (file.size > maxSize) {
            alert("å›¾ç‰‡è¶…è¿‡ 1MBï¼Œå»ºè®®å‹ç¼©åå†ä¸Šä¼ ã€‚");
            return;
          }
          const reader = new FileReader();
          reader.onload = (e) => {
            newItem.value.image = e.target.result;
          };
          reader.readAsDataURL(file);
        }
      };

      const saveItem = () => {
        if (modalType.value === "info") {
          if (isEditing.value) {
            const idx = infoList.value.findIndex(
              (i) => i.id === newItem.value.id
            );
            if (idx !== -1) infoList.value[idx] = { ...newItem.value };
          } else {
            infoList.value.push({
              ...newItem.value,
              id: Date.now(),
            });
          }
        } else if (modalType.value === "schedule") {
          if (!selectedDate.value || selectedDate.value === "todo") {
            alert("è¯·å…ˆé€‰æ‹©å…·ä½“æ—¥æœŸåå†æ–°å¢è¡Œç¨‹ã€‚");
            return;
          }
          if (isEditing.value) {
            const idx = itineraryData.value.findIndex(
              (i) => i.id === newItem.value.id
            );
            if (idx !== -1) {
              itineraryData.value[idx] = { ...newItem.value };
            }
          } else {
            itineraryData.value.push({
              ...newItem.value,
              id: Date.now(),
              date: selectedDate.value,
              lat:
                settings.value.weatherLat +
                (Math.random() - 0.5) * 0.05,
              lng:
                settings.value.weatherLng +
                (Math.random() - 0.5) * 0.05,
            });
          }
          initSortable();
        } else if (modalType.value === "money") {
          if (!newItem.value.amount) {
            alert("è¯·è¾“å…¥é‡‘é¢ã€‚");
            return;
          }
          if (isEditing.value) {
            const idx = expenses.value.findIndex(
              (e) => e.id === newItem.value.id
            );
            if (idx !== -1) {
              expenses.value[idx] = { ...newItem.value };
            }
          } else {
            expenses.value.push({
              ...newItem.value,
              id: Date.now(),
            });
          }
        } else if (modalType.value === "shop") {
          if (!newItem.value.name) {
            alert("è¯·è¾“å…¥å•†å“åç§°ã€‚");
            return;
          }
          if (!newItem.value.currency) {
            newItem.value.currency = settings.value.baseCurrencyCode;
          }
          if (isEditing.value) {
            const idx = shoppingList.value.findIndex(
              (s) => s.id === newItem.value.id
            );
            if (idx !== -1) {
              shoppingList.value[idx] = { ...newItem.value };
            }
          } else {
            shoppingList.value.push({
              ...newItem.value,
              id: Date.now(),
              bought: false,
            });
          }
        } else if (modalType.value === "todo") {
          if (!newItem.value.text) {
            alert("è¯·è¾“å…¥å¾…åŠå†…å®¹ã€‚");
            return;
          }
          if (isEditing.value) {
            const idx = todoList.value.findIndex(
              (t) => t.id === newItem.value.id
            );
            if (idx !== -1) {
              todoList.value[idx] = { ...newItem.value };
            }
          } else {
            todoList.value.push({
              ...newItem.value,
              id: Date.now(),
              done: false,
            });
          }
        }

        saveToLocalStorage();
        if (currentTab.value === "map") {
          updateMapMarkers();
        }
        closeModal();
      };

      const deleteItem = (type, id) => {
        if (!confirm("ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ")) return;
        if (type === "schedule") {
          itineraryData.value = itineraryData.value.filter(
            (i) => i.id !== id
          );
        } else if (type === "todo") {
          todoList.value = todoList.value.filter((i) => i.id !== id);
        } else if (type === "expense") {
          expenses.value = expenses.value.filter((i) => i.id !== id);
        } else if (type === "shop") {
          shoppingList.value = shoppingList.value.filter(
            (i) => i.id !== id
          );
        } else if (type === "info") {
          infoList.value = infoList.value.filter((i) => i.id !== id);
        }
        saveToLocalStorage();
        if (currentTab.value === "map") {
          updateMapMarkers();
        }
      };

      const toggleTodo = (item) => {
        item.done = !item.done;
        saveToLocalStorage();
      };

      const toggleBought = (item) => {
        item.bought = !item.bought;
        saveToLocalStorage();
      };

      const saveToLocalStorage = () => {
        const data = {
          version: 1,
          settings: settings.value,
          exchangeRate: exchangeRate.value,
          itinerary: itineraryData.value,
          expenses: expenses.value,
          shop: shoppingList.value,
          todo: todoList.value,
          info: infoList.value,
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      };

      const loadData = () => {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return;
          const data = JSON.parse(raw);

          if (data.settings) {
            settings.value = {
              ...settings.value,
              ...data.settings,
            };
          }
          if (typeof data.exchangeRate === "number") {
            exchangeRate.value = data.exchangeRate;
          }

          itineraryData.value = Array.isArray(data.itinerary)
            ? data.itinerary
            : [];
          expenses.value = Array.isArray(data.expenses)
            ? data.expenses
            : [];
          shoppingList.value = Array.isArray(data.shop)
            ? data.shop
            : [];
          // å…¼å®¹æ—§ç‰ˆæœ¬è´­ç‰©æ¸…å•ï¼šå¡«å…… currency
          shoppingList.value = shoppingList.value.map((item) => ({
            ...item,
            currency:
              item.currency || settings.value.baseCurrencyCode,
          }));
          todoList.value = Array.isArray(data.todo)
            ? data.todo
            : [];
          infoList.value = Array.isArray(data.info)
            ? data.info
            : [];
        } catch (e) {
          console.error("è¯»å–æœ¬åœ°æ•°æ®å¤±è´¥ï¼š", e);
        }
      };

      const initMap = () => {
        mapObj.value = L.map("map").setView(
          [settings.value.weatherLat, settings.value.weatherLng],
          11
        );
        baseTileLayer = L.tileLayer(
          "https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",
          {
            attribution: "Â© OpenStreetMap Â© CARTO",
            maxZoom: 19,
          }
        ).addTo(mapObj.value);

        // å…¬å…±äº¤é€šå›¾å±‚ï¼ˆPublic Transport OSMï¼‰
        transitTileLayer = L.tileLayer(
          "https://tile.memomaps.de/tilegen/{z}/{x}/{y}.png",
          {
            attribution:
              "Map data Â© OpenStreetMap contributors, Public Transport Layer Â© memomaps.de",
            maxZoom: 18,
          }
        );
      };

      const updateMapMarkers = () => {
        if (!mapObj.value) return;
        markers.value.forEach((m) => mapObj.value.removeLayer(m));
        markers.value = [];
        const bounds = [];
        dailyItinerary.value.forEach((item) => {
          if (item.showOnMap === false) return;
          if (item.lat && item.lng) {
            const iconHtml = `<div class="w-8 h-8 rounded-full ${
              getCategoryColor(item.category)
            } border-2 border-white flex items-center justify-center text-white shadow-lg">
              <i class="${getCategoryIcon(
                item.category
              )} text-xs"></i></div>`;
            const icon = L.divIcon({
              className: "custom-pin",
              html: iconHtml,
              iconSize: [32, 32],
              iconAnchor: [16, 32],
            });
            const m = L.marker([item.lat, item.lng], { icon })
              .addTo(mapObj.value)
              .bindPopup(`<b>${item.location}</b><br>${item.time}`);
            markers.value.push(m);
            bounds.push([item.lat, item.lng]);
          }
        });
        if (bounds.length) {
          mapObj.value.fitBounds(bounds, { padding: [50, 50] });
        } else {
          mapObj.value.setView(
            [settings.value.weatherLat, settings.value.weatherLng],
            11
          );
        }
      };

      const toggleMapMode = () => {
        if (!mapObj.value) return;
        if (mapMode.value === "normal") {
          if (baseTileLayer) mapObj.value.removeLayer(baseTileLayer);
          if (transitTileLayer) transitTileLayer.addTo(mapObj.value);
          mapMode.value = "transit";
        } else {
          if (transitTileLayer) mapObj.value.removeLayer(transitTileLayer);
          if (baseTileLayer) baseTileLayer.addTo(mapObj.value);
          mapMode.value = "normal";
        }
      };

      const fetchWeather = async () => {
        if (selectedDate.value === "todo") {
          weatherInfo.value = {
            temp: "--",
            feel: "--",
            desc: "è¯·é€‰æ‹©å…·ä½“æ—¥æœŸ",
            icon: "fas fa-cloud",
          };
          return;
        }
        try {
          const lat = settings.value.weatherLat;
          const lng = settings.value.weatherLng;
          const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lng}&current_weather=true`;
          const res = await fetch(url);
          const data = await res.json();
          if (data && data.current_weather) {
            const t = data.current_weather.temperature;
            const code = data.current_weather.weathercode;
            let desc = "æ™´";
            let icon = "fas fa-sun";
            if (code >= 51 && code <= 67) {
              desc = "å°é›¨";
              icon = "fas fa-cloud-rain";
            } else if (code >= 71 && code <= 77) {
              desc = "ä¸‹é›ª";
              icon = "fas fa-snowflake";
            } else if (code >= 95) {
              desc = "å¼ºå¯¹æµ";
              icon = "fas fa-poo-storm";
            } else if (code >= 1 && code <= 3) {
              desc = "å¤šäº‘";
              icon = "fas fa-cloud-sun";
            }
            weatherInfo.value = {
              temp: Math.round(t),
              feel: Math.round(t),
              desc,
              icon,
            };
            return;
          }
        } catch (e) {
          console.warn("å®æ—¶å¤©æ°”è·å–å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿï¼š", e);
        }
        weatherInfo.value = {
          temp: 25,
          feel: 27,
          desc: "æ™´æ—¶å¤šäº‘ï¼ˆæ¨¡æ‹Ÿæ•°æ®ï¼‰",
          icon: "fas fa-cloud-sun",
        };
      };

      const exportData = () => {
        const data = {
          version: 1,
          settings: settings.value,
          exchangeRate: exchangeRate.value,
          itinerary: itineraryData.value,
          expenses: expenses.value,
          shop: shoppingList.value,
          todo: todoList.value,
          info: infoList.value,
        };
        const blob = new Blob([JSON.stringify(data, null, 2)], {
          type: "application/json",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        const now = new Date();
        const yyyy = now.getFullYear();
        const mm = String(now.getMonth() + 1).padStart(2, "0");
        const dd = String(now.getDate()).padStart(2, "0");
        a.href = url;
        a.download = `UsTrip_backup_${yyyy}-${mm}-${dd}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      };

      const importInput = ref(null);

      const triggerImport = () => {
        if (importInput.value) {
          importInput.value.value = "";
          importInput.value.click();
        }
      };

      const handleImport = (event) => {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const data = JSON.parse(e.target.result);
            if (data.settings) {
              settings.value = {
                ...settings.value,
                ...data.settings,
              };
            }
            if (typeof data.exchangeRate === "number") {
              exchangeRate.value = data.exchangeRate;
            }
            itineraryData.value = Array.isArray(data.itinerary)
              ? data.itinerary
              : [];
            expenses.value = Array.isArray(data.expenses)
              ? data.expenses
              : [];
            shoppingList.value = Array.isArray(data.shop)
              ? data.shop
              : [];
            shoppingList.value = shoppingList.value.map((item) => ({
              ...item,
              currency:
                item.currency || settings.value.baseCurrencyCode,
            }));
            todoList.value = Array.isArray(data.todo)
              ? data.todo
              : [];
            infoList.value = Array.isArray(data.info)
              ? data.info
              : [];
            saveToLocalStorage();
            alert("å¯¼å…¥æˆåŠŸï¼");
            currentTab.value = "schedule";
            selectedDate.value = "todo";
          } catch (err) {
            console.error("å¯¼å…¥æ•°æ®å¤±è´¥ï¼š", err);
            alert("å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®æˆ–å†…å®¹æŸåã€‚");
          }
        };
        reader.readAsText(file, "utf-8");
      };

      watch(
        () => ({
          ...settings.value,
          exchangeRate: exchangeRate.value,
        }),
        () => {
          saveToLocalStorage();
        },
        { deep: true }
      );

      watch(
        () => [currentTab.value, selectedDate.value],
        () => {
          if (
            currentTab.value === "schedule" &&
            selectedDate.value !== "todo"
          ) {
            fetchWeather();
          }
        }
      );

      onMounted(() => {
        loadData();
        if (itineraryData.value.length === 0) {
          const d = settings.value.tripStartDate || "2026-01-08";
          itineraryData.value.push(
            {
              id: Date.now(),
              date: d,
              time: "09:00",
              category: "flight",
              location: "ä»å‰éš†å¡é£å¾€å°åŒ—",
              address: "",
              note: "æå‰ 2 å°æ—¶åˆ°æœºåœº",
              mapsUrl: "",
              showOnMap: true,
              fromCode: "KUL",
              toCode: "TPE",
              flightNo: "ç¤ºä¾‹èˆªç­",
              status: "å¾…ç¡®è®¤",
              lat: settings.value.weatherLat,
              lng: settings.value.weatherLng,
            },
            {
              id: Date.now() + 1,
              date: d,
              time: "15:00",
              category: "sightseeing",
              location: "å°åŒ—è½¦ç«™å‘¨è¾¹æ•£æ­¥",
              address: "å°åŒ—è½¦ç«™",
              note: "ç†Ÿæ‚‰ç¯å¢ƒï¼Œé¡ºä¾¿ä¹°æ‚ æ¸¸å¡",
              mapsUrl: "",
              showOnMap: true,
              lat: settings.value.weatherLat + 0.01,
              lng: settings.value.weatherLng + 0.01,
            }
          );
        }
        if (todoList.value.length === 0) {
          todoList.value.push(
            {
              id: Date.now() + 2,
              text: "ä¹°æ—…è¡Œä¿é™©",
              done: false,
            },
            {
              id: Date.now() + 3,
              text: "ç¡®è®¤æœºç¥¨ä¸é…’åº—è®¢å•é‚®ä»¶",
              done: false,
            }
          );
        }
        fetchWeather();
      });

      return {
        currentTab,
        selectedDate,
        tripDates,
        dailyItinerary,
        mapMarkersCount,
        itineraryData,
        expenses,
        shoppingList,
        todoList,
        infoList,
        settings,
        exchangeRate,
        totalExpenseBase,
        totalExpenseTarget,
        totalCashBase,
        totalCashTarget,
        totalCardBase,
        totalCardTarget,
        expenseFilter,
        filteredExpenses,
        weatherInfo,
        showModal,
        modalType,
        modalTitle,
        newItem,
        isEditing,
        sortableList,
        importInput,
        mapMode,

        getCategoryIcon,
        getCategoryColor,
        selectDate,
        switchTab,
        openModal,
        closeModal,
        saveItem,
        deleteItem,
        toggleTodo,
        toggleBought,
        handleImageUpload,
        exportData,
        triggerImport,
        handleImport,
        toggleMapMode,
      };
    },
  }).mount("#app");
</script>
</body>
</html>